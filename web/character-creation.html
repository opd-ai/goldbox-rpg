<!DOCTYPE html>
<html>
<head>
    <title>Character Creation - Gold Box RPG</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/css/main.css">
    <style>
        .character-creation {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #2c3e50;
            border-radius: 8px;
            color: #ecf0f1;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #3498db;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #34495e;
            border-radius: 4px;
            background: #34495e;
            color: #ecf0f1;
            font-size: 14px;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .class-info {
            background: #34495e;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .attributes-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .attribute-display {
            text-align: center;
            background: #34495e;
            padding: 10px;
            border-radius: 4px;
        }
        
        .attribute-value {
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
        }
        
        .attribute-modifier {
            font-size: 12px;
            color: #95a5a6;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .error-message {
            background: #e74c3c;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .success-message {
            background: #27ae60;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .requirements {
            font-size: 12px;
            color: #95a5a6;
            margin-top: 5px;
        }
        
        .custom-attributes {
            display: none;
        }
        
        .custom-attributes.show {
            display: block;
        }
        
        .nav-link {
            color: #3498db;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }
        
        .nav-link:hover {
            color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="character-creation">
        <a href="/" class="nav-link">‚Üê Back to Game</a>
        
        <h1>Create Your Character</h1>
        
        <div id="message-area"></div>
        
        <form id="character-form">
            <div class="form-group">
                <label for="character-name">Character Name:</label>
                <input type="text" id="character-name" name="name" required maxlength="50" 
                       placeholder="Enter character name">
            </div>
            
            <div class="form-group">
                <label for="character-class">Character Class:</label>
                <select id="character-class" name="class" required>
                    <option value="">Select a class</option>
                    <option value="fighter">Fighter</option>
                    <option value="mage">Mage</option>
                    <option value="cleric">Cleric</option>
                    <option value="thief">Thief</option>
                    <option value="ranger">Ranger</option>
                    <option value="paladin">Paladin</option>
                </select>
                <div id="class-info" class="class-info" style="display: none;"></div>
            </div>
            
            <div class="form-group">
                <label for="attribute-method">Attribute Generation:</label>
                <select id="attribute-method" name="attribute_method" required>
                    <option value="">Select method</option>
                    <option value="roll">Roll 4d6, drop lowest</option>
                    <option value="pointbuy">Point Buy (27 points)</option>
                    <option value="standard">Standard Array</option>
                    <option value="custom">Custom Values</option>
                </select>
            </div>
            
            <div id="custom-attributes" class="custom-attributes">
                <h3>Custom Attributes (3-18 each):</h3>
                <div class="attributes-section">
                    <div class="form-group">
                        <label for="custom-str">Strength:</label>
                        <input type="number" id="custom-str" min="3" max="18" value="10">
                    </div>
                    <div class="form-group">
                        <label for="custom-dex">Dexterity:</label>
                        <input type="number" id="custom-dex" min="3" max="18" value="10">
                    </div>
                    <div class="form-group">
                        <label for="custom-con">Constitution:</label>
                        <input type="number" id="custom-con" min="3" max="18" value="10">
                    </div>
                    <div class="form-group">
                        <label for="custom-int">Intelligence:</label>
                        <input type="number" id="custom-int" min="3" max="18" value="10">
                    </div>
                    <div class="form-group">
                        <label for="custom-wis">Wisdom:</label>
                        <input type="number" id="custom-wis" min="3" max="18" value="10">
                    </div>
                    <div class="form-group">
                        <label for="custom-cha">Charisma:</label>
                        <input type="number" id="custom-cha" min="3" max="18" value="10">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label>
                    <input type="checkbox" id="starting-equipment" name="starting_equipment" checked>
                    Include starting equipment
                </label>
            </div>
            
            <div class="form-group">
                <label for="starting-gold">Starting Gold:</label>
                <input type="number" id="starting-gold" name="starting_gold" min="0" max="1000" 
                       placeholder="Leave empty for class default">
            </div>
            
            <div class="button-group">
                <button type="button" id="preview-btn" class="btn btn-secondary">Preview Character</button>
                <button type="submit" class="btn btn-primary">Create Character</button>
            </div>
        </form>
        
        <div id="character-preview" style="display: none;">
            <h3>Character Preview</h3>
            <div id="preview-content"></div>
        </div>
    </div>

    <script>
        class CharacterCreator {
            constructor() {
                this.form = document.getElementById('character-form');
                this.classSelect = document.getElementById('character-class');
                this.attributeMethodSelect = document.getElementById('attribute-method');
                this.customAttributesDiv = document.getElementById('custom-attributes');
                this.messageArea = document.getElementById('message-area');
                this.previewDiv = document.getElementById('character-preview');
                
                this.initializeEventListeners();
                this.loadClassData();
            }
            
            initializeEventListeners() {
                this.classSelect.addEventListener('change', () => this.showClassInfo());
                this.attributeMethodSelect.addEventListener('change', () => this.toggleCustomAttributes());
                document.getElementById('preview-btn').addEventListener('click', () => this.previewCharacter());
                this.form.addEventListener('submit', (e) => this.submitCharacter(e));
            }
            
            loadClassData() {
                this.classData = {
                    fighter: {
                        name: "Fighter",
                        description: "A warrior skilled in combat and tactics",
                        hitDice: "1d10",
                        requirements: { strength: 13 },
                        abilities: ["Second Wind", "Action Surge"]
                    },
                    mage: {
                        name: "Mage", 
                        description: "A spellcaster who manipulates arcane forces",
                        hitDice: "1d4",
                        requirements: { intelligence: 13 },
                        abilities: ["Cantrips", "Spell Casting"]
                    },
                    cleric: {
                        name: "Cleric",
                        description: "A divine spellcaster and healer", 
                        hitDice: "1d8",
                        requirements: { wisdom: 13 },
                        abilities: ["Turn Undead", "Divine Casting"]
                    },
                    thief: {
                        name: "Thief",
                        description: "A stealthy character skilled in subterfuge",
                        hitDice: "1d6", 
                        requirements: { dexterity: 13 },
                        abilities: ["Sneak Attack", "Thieves Tools"]
                    },
                    ranger: {
                        name: "Ranger",
                        description: "A wilderness warrior and tracker",
                        hitDice: "1d8",
                        requirements: { dexterity: 13, wisdom: 13 },
                        abilities: ["Favored Enemy", "Natural Magic"]
                    },
                    paladin: {
                        name: "Paladin", 
                        description: "A holy warrior dedicated to justice",
                        hitDice: "1d10",
                        requirements: { strength: 13, charisma: 13 },
                        abilities: ["Lay on Hands", "Divine Smite"]
                    }
                };
            }
            
            showClassInfo() {
                const selectedClass = this.classSelect.value;
                const infoDiv = document.getElementById('class-info');
                
                if (selectedClass && this.classData[selectedClass]) {
                    const classInfo = this.classData[selectedClass];
                    const reqText = Object.entries(classInfo.requirements)
                        .map(([attr, val]) => `${attr.charAt(0).toUpperCase() + attr.slice(1)} ${val}+`)
                        .join(', ');
                    
                    infoDiv.innerHTML = `
                        <h4>${classInfo.name}</h4>
                        <p>${classInfo.description}</p>
                        <p><strong>Hit Dice:</strong> ${classInfo.hitDice}</p>
                        <p><strong>Requirements:</strong> ${reqText}</p>
                        <p><strong>Abilities:</strong> ${classInfo.abilities.join(', ')}</p>
                    `;
                    infoDiv.style.display = 'block';
                } else {
                    infoDiv.style.display = 'none';
                }
            }
            
            toggleCustomAttributes() {
                const method = this.attributeMethodSelect.value;
                if (method === 'custom') {
                    this.customAttributesDiv.classList.add('show');
                } else {
                    this.customAttributesDiv.classList.remove('show');
                }
            }
            
            showMessage(message, type = 'error') {
                this.messageArea.innerHTML = `<div class="${type}-message">${message}</div>`;
                setTimeout(() => {
                    this.messageArea.innerHTML = '';
                }, 5000);
            }
            
            getFormData() {
                const formData = new FormData(this.form);
                const data = {
                    name: formData.get('name'),
                    class: formData.get('class'),
                    attribute_method: formData.get('attribute_method'),
                    starting_equipment: document.getElementById('starting-equipment').checked,
                    starting_gold: parseInt(formData.get('starting_gold')) || 0
                };
                
                if (data.attribute_method === 'custom') {
                    data.custom_attributes = {
                        strength: parseInt(document.getElementById('custom-str').value),
                        dexterity: parseInt(document.getElementById('custom-dex').value),
                        constitution: parseInt(document.getElementById('custom-con').value),
                        intelligence: parseInt(document.getElementById('custom-int').value),
                        wisdom: parseInt(document.getElementById('custom-wis').value),
                        charisma: parseInt(document.getElementById('custom-cha').value)
                    };
                }
                
                return data;
            }
            
            async previewCharacter() {
                const data = this.getFormData();
                
                try {
                    const response = await fetch('/rpc', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            method: 'createCharacter',
                            params: data
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.error) {
                        this.showMessage(result.error.message);
                        return;
                    }
                    
                    if (result.result && result.result.success) {
                        this.displayPreview(result.result);
                    } else {
                        this.showMessage(result.result.errors.join(', '));
                    }
                } catch (error) {
                    this.showMessage('Preview failed: ' + error.message);
                }
            }
            
            displayPreview(result) {
                const stats = result.generated_stats;
                const modifier = (score) => Math.floor((score - 10) / 2);
                const modText = (mod) => mod >= 0 ? `+${mod}` : `${mod}`;
                
                const previewContent = `
                    <div class="attributes-section">
                        <div class="attribute-display">
                            <div>Strength</div>
                            <div class="attribute-value">${stats.strength}</div>
                            <div class="attribute-modifier">${modText(modifier(stats.strength))}</div>
                        </div>
                        <div class="attribute-display">
                            <div>Dexterity</div>
                            <div class="attribute-value">${stats.dexterity}</div>
                            <div class="attribute-modifier">${modText(modifier(stats.dexterity))}</div>
                        </div>
                        <div class="attribute-display">
                            <div>Constitution</div>
                            <div class="attribute-value">${stats.constitution}</div>
                            <div class="attribute-modifier">${modText(modifier(stats.constitution))}</div>
                        </div>
                        <div class="attribute-display">
                            <div>Intelligence</div>
                            <div class="attribute-value">${stats.intelligence}</div>
                            <div class="attribute-modifier">${modText(modifier(stats.intelligence))}</div>
                        </div>
                        <div class="attribute-display">
                            <div>Wisdom</div>
                            <div class="attribute-value">${stats.wisdom}</div>
                            <div class="attribute-modifier">${modText(modifier(stats.wisdom))}</div>
                        </div>
                        <div class="attribute-display">
                            <div>Charisma</div>
                            <div class="attribute-value">${stats.charisma}</div>
                            <div class="attribute-modifier">${modText(modifier(stats.charisma))}</div>
                        </div>
                    </div>
                    <p><strong>Hit Points:</strong> ${result.character.MaxHP}</p>
                    <p><strong>Armor Class:</strong> ${result.character.ArmorClass}</p>
                    <p><strong>Starting Gold:</strong> ${result.character.Gold}</p>
                    ${result.starting_items.length > 0 ? 
                        `<p><strong>Starting Equipment:</strong> ${result.starting_items.map(item => item.Name).join(', ')}</p>` : ''}
                `;
                
                document.getElementById('preview-content').innerHTML = previewContent;
                this.previewDiv.style.display = 'block';
            }
            
            async submitCharacter(e) {
                e.preventDefault();
                
                const data = this.getFormData();
                
                try {
                    const response = await fetch('/rpc', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            method: 'createCharacter',
                            params: data
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (result.error) {
                        this.showMessage(result.error.message);
                        return;
                    }
                    
                    if (result.result && result.result.success) {
                        this.showMessage(`Character "${data.name}" created successfully! Session ID: ${result.result.session_id}`, 'success');
                        
                        // Redirect to game after a delay
                        setTimeout(() => {
                            window.location.href = '/';
                        }, 2000);
                    } else {
                        this.showMessage(result.result.errors.join(', '));
                    }
                } catch (error) {
                    this.showMessage('Character creation failed: ' + error.message);
                }
            }
        }
        
        // Initialize character creator when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new CharacterCreator();
        });
    </script>
</body>
</html>
